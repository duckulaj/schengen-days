<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Schengen Days Calculator</title>
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <link rel="stylesheet" th:href="@{/css/theme.css}"/>
  <style th:replace="~{fragments/calendar-style :: style}"></style>
</head>
<body>
<h1>Schengen 90/180 calculator</h1>
<p class="muted">
  Logged in as <span th:text="${#authentication.name}"></span> ‚Äî
  <form th:action="@{/logout}" method="post" style="display:inline;">
    <button type="submit" style="background:none;border:none;color:#0066cc;cursor:pointer;padding:0;text-decoration:underline;">Logout</button>
  </form>
  <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">| <a th:href="@{/admin}">Admin</a></span>
  |
  <span id="theme-toggle" class="theme-toggle">
    <span class="theme-toggle-icon">üåô</span>
    <span class="theme-toggle-text">Dark</span>
  </span>
</p>

<div class="card">
  <h2>Reference date</h2>
  <p class="muted">Calculate remaining days as of this date (can be in the future).</p>

  <div class="row">
    <div>
      <label for="referenceDate">Reference date</label>
      <input id="referenceDate" type="date"/>
    </div>
    <div>
      <button id="refreshBtn" type="button" class="icon-btn" title="Refresh status">
        <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
      </button>
    </div>
    <div class="pill" id="who">user: (server)</div>
  </div>

  <p class="stat">
    Used last 180: <strong id="used">-</strong> days |
    Remaining: <strong id="remaining">-</strong> days |
    Next legal entry: <strong id="nextEntry">-</strong>
  </p>
  <p class="error" id="statusError"></p>
</div>

<div class="card">
  <h2>Add a stay</h2>
  <div class="row">
    <div>
      <label for="entryDate">Stay dates</label>
      <div class="range-picker" id="rangePicker">
        <div class="range-inputs">
          <input id="entryDate" type="text" placeholder="Start date" readonly/>
          <span>‚Üí</span>
          <input id="exitDate" type="text" placeholder="End date" readonly/>
        </div>
        <div id="rangeCalendar" class="range-calendar" aria-hidden="true">
          <div class="range-cal-header">
            <button type="button" class="range-cal-nav" id="calPrev">‚ùÆ</button>
            <button type="button" class="range-cal-nav" id="calNext">‚ùØ</button>
          </div>
          <div class="range-months-container">
              <div class="range-month">
                  <div class="range-cal-title" id="calTitle1">Month YYYY</div>
                  <div class="range-cal-grid" id="calGrid1"></div>
              </div>
              <div class="range-month">
                  <div class="range-cal-title" id="calTitle2">Month YYYY</div>
                  <div class="range-cal-grid" id="calGrid2"></div>
              </div>
          </div>
          <div class="range-cal-actions">
            <button type="button" id="calClear">Clear</button>
            <button type="button" id="calApply">Apply</button>
          </div>
        </div>
      </div>
    </div>
    <div>
      <button id="saveBtn" type="button" class="icon-btn" title="Save stay">
        <svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
      </button>
    </div>
  </div>
  <p class="error" id="saveError"></p>

  <h3>Saved stays</h3>

  <div class="row">
    <div>
      <label for="pageSize">Page size</label>
      <select id="pageSize">
        <option>5</option>
        <option selected>10</option>
        <option>20</option>
        <option>50</option>
      </select>
    </div>
  </div>

  <table>
    <thead>
    <tr><th>Entry</th><th>Exit</th><th>Days</th><th>Actions</th></tr>
    </thead>
    <tbody id="staysTable"></tbody>
  </table>

  <div class="pager">
    <button id="prevBtn" type="button">Prev</button>
    <button id="nextBtn" type="button">Next</button>
    <span class="muted" id="pageInfo">-</span>
  </div>
</div>

<script th:replace="~{fragments/index-script :: script}"></script>
<script th:src="@{/js/theme-toggle.js}"></script>
</body>
</html>
